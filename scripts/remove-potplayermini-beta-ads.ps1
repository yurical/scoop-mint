param(
	[Parameter()][string]$Path
)

function Convert-HexToFile {
    param(
        [Parameter()][string]$Hex,
        [Parameter()][string]$Destination
    )

    $TempFile = New-TemporaryFile
    Set-Content -Path $TempFile -Value $Hex -Force
    certutil -decodehex -f $TempFile.FullName $Destination 12
}

function ConvertTo-Hex {
    param(
        [Parameter()][string]$Path
    )

    if ($PSVersionTable.PSVersion.Major -ge 7) {
        $Content = Get-Content $Path -Raw -AsByteStream
    } else {
        $Content = Get-Content $Path -Encoding Byte -Raw
    }

    return [System.BitConverter]::ToString($Content).replace('-','').ToUpper()
}

$DllReplaceList = @(
	"000070006C00610079002E006B0061006B0061006F002E0063006F006D0000"
	"00766164732D6170692E6461756D6B616B616F2E636F6D00"
	"0073616E64626F782D766164732D6170692E6465762E6461756D6B616B616F2E696F00"
	"006362742D766164732D6170692E6465762E6461756D6B616B616F2E696F00"
	"000068007400740070003A002F002F00740031002E0062006500740061002E006400610075006D00630064006E002E006E00650074002F0070006F00740070006C0061007900650072002F0070006F006C006C0069006E0067002F0064006100740061002E006A0073006F006E0000"
	"0000680074007400700073003A002F002F00740031002E006400610075006D00630064006E002E006E00650074002F00610064006600690074002F00680074006D006C002F00440041004E002D0076006600390070003800340061003900650035006F0036002E00680074006D006C0000"
	"0000680074007400700073003A002F002F00700031002D0070006C00610079002E00650064006700650034006B002E0063006F006D002F0073007400610074007500730000"
	"0000680074007400700073003A002F002F00700032002D0070006C00610079002E00650064006700650034006B002E0063006F006D002F0073007400610074007500730000"
	"000068007400740070003A002F002F00740031002E006400610075006D00630064006E002E006E00650074002F0070006F00740070006C0061007900650072002F0050006F00740050006C00610079006500720000"
	"0000740031002E006400610075006D00630064006E002E006E00650074000000"
	"00003200310031002E003200330031002E003100300031002E0031003600380000"
	"00003100310033002E00320039002E003100380036002E003600380000"
	"0000680074007400700073003A002F002F0070006C00610079002E006B0061006B0061006F002E0063006F006D002F007300760063002F0070006F00740070006C0061007900650072002F006100700069002F0064006E00730000"
	"00737461742E74696172612E6B616B616F2E636F6D00"
	"0073616E64626F782D737461742E74696172612E6B616B616F2E636F6D00"

	"0000680074007400700025003300410025003200460025003200460074007200610063006B002E006D006F00620069006C0065006100700070002E006400610075006D002E006E006500740025003200460000"
	"0000680074007400700073003A002F002F0074007200610063006B002E00740069006100720061002E006400610075006D002E006E00650074002F0071007500650065006E002F0066006F006F007400730074006500700073003F00750072006C003D0025007300260073007600630064006F006D00610069006E003D0074007200610063006B002E006D006F00620069006C0065006100700070002E006400610075006D002E006E0065007400260070006100720061006D0031003D0025007300260070006100720061006D0032003D0025007300260070006100720061006D0033003D0025007300260070006100720061006D0034003D00250073002600640075006D006D0079003D002500730000"
	"0000680074007400700025003300410025003200460025003200460070006F00740070006C0061007900650072002E006D002E0061007000700025003200460000"
	"0000680074007400700073003A002F002F0074007200610063006B002E00740069006100720061002E006400610075006D002E006E00650074002F0071007500650065006E002F0074006F007500630068003F00750072006C003D0025007300260073007600630064006F006D00610069006E003D0070006F00740070006C0061007900650072002E006D002E0061007000700026007400650031003D002500730026007400650032003D002500730026007400650033003D002500730026007400650034003D00250073002600640075006D006D0079003D002500730000"
)

$dll = Get-Item "$Path\PotPlayer64.dll"
$dllhex = ConvertTo-Hex -Path $dll
$dllver = $dll.VersionInfo.FileVersion.replace(',', '.').replace(' ','')
Write-Host ("{0} version: {1}" -f $dll.Name, $dllver)
Write-Host "Replacing hexes..."
ForEach ($hex in $DllReplaceList) {
	$hexstr = [System.Text.Encoding]::UTF8.GetString([byte[]]($hex -replace '(..)', '0x$&,' -split ',' -ne ''))
	if ($dllhex -Match $hex) {
		Write-Host ("Found: {0}" -f $hexstr)
		$zerofill = "0" * $hex.Length
		$dllhex = ($dllhex -replace $hex, $zerofill)
	} else {
		Write-Warning ("Not Found: {0}" -f $hexstr)
	}
}
Convert-HexToFile -Hex $dllhex -Destination $dll

$exe = Get-Item "$Path\PotPlayerMini64.exe"
$exehex = ConvertTo-Hex -Path $exe
$exever = $exe.VersionInfo.FileVersion.replace(',', '.').replace(' ','')
Write-Host ("{0} version: {1}" -f $exe.Name, $exever)
Write-Host "Replacing hexes..."
$hex = "C00F844202000048"
$replace = "C090909090909048"
if ($exehex -Match $hex) {
	Write-Host ("Found: {0}" -f $hex)
	$exehex = ($exehex -replace $hex, $replace)
} else {
	Write-Warning ("Not Found: {0}" -f $hex)
}
Convert-HexToFile -Hex $exehex -Destination $exe
